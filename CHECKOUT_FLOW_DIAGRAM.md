# Avhira Checkout Flow Diagram

## ğŸ”„ Complete User Journey

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                         SHOPPING CART                                    â”‚
â”‚  User adds products â†’ Cart Slider â†’ "Proceed to Checkout" Button       â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                      â”‚
                      â–¼
         â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
         â”‚   Is User Logged In?   â”‚
         â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                  â”‚
        â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
        â”‚                    â”‚
        â–¼ NO                 â–¼ YES
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  GUEST USER   â”‚    â”‚  LOGGED-IN USER  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
        â”‚                     â”‚
        â”‚                     â”‚ (Skip Step 1)
        â–¼                     â”‚
â•”â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•—         â”‚
â•‘   STEP 1: CONTACT â•‘         â”‚
â•‘   INFORMATION     â•‘         â”‚
â• â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•£         â”‚
â•‘ â€¢ Name            â•‘         â”‚
â•‘ â€¢ Email           â•‘         â”‚
â•‘ â€¢ Phone           â•‘         â”‚
â•‘ â€¢ Password (NEW)  â•‘         â”‚
â•šâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•         â”‚
        â”‚                     â”‚
        â”‚ [Continue] â”€â”€â”€â”€â”€â”€â”€â”€â–ºâ”‚
        â”‚                     â”‚
        â–¼                     â–¼
â•”â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•—
â•‘   STEP 2: DELIVERY ADDRESS & PAYMENT   â•‘
â• â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•£
â•‘ Contact Info (Logged-in: Pre-filled)   â•‘
â•‘ âœ“ Name: [Auto-filled from account]    â•‘
â•‘ âœ“ Email: [Auto-filled from account]   â•‘
â•‘ âœ“ Phone: [Auto-filled if saved]       â•‘
â•‘                                        â•‘
â•‘ Delivery Address (Pre-fill if exists)  â•‘
â•‘ â€¢ Complete Address                     â•‘
â•‘ â€¢ Pincode                              â•‘
â•‘ â€¢ City                                 â•‘
â•‘ â€¢ State                                â•‘
â•‘ â€¢ Country (India - default)            â•‘
â•šâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
        â”‚
        â”‚ [Proceed to Payment] Button
        â”‚
        â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  VALIDATION                             â”‚
â”‚  âœ“ All required fields filled          â”‚
â”‚  âœ“ Email format valid                  â”‚
â”‚  âœ“ Phone 10 digits                     â”‚
â”‚  âœ“ Pincode 6 digits                    â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
        â”‚
        â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  CREATE RAZORPAY ORDER                  â”‚
â”‚  POST /api/checkout/create-razorpay-    â”‚
â”‚  order                                  â”‚
â”‚  â†’ Returns: order_id, amount            â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
        â”‚
        â–¼
â•”â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•—
â•‘      RAZORPAY PAYMENT MODAL            â•‘
â• â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•£
â•‘  Payment Options:                      â•‘
â•‘  â–¡ Credit/Debit Card                   â•‘
â•‘  â–¡ UPI                                 â•‘
â•‘  â–¡ Netbanking                          â•‘
â•‘  â–¡ Wallet                              â•‘
â•‘                                        â•‘
â•‘  [Complete Payment] Button             â•‘
â•šâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
        â”‚
        â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  USER COMPLETES PAYMENT                 â”‚
â”‚  Razorpay processes transaction        â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
        â”‚
        â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  RAZORPAY RETURNS RESPONSE              â”‚
â”‚  â€¢ razorpay_payment_id                 â”‚
â”‚  â€¢ razorpay_order_id                   â”‚
â”‚  â€¢ razorpay_signature                  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
        â”‚
        â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  SUBMIT TO BACKEND                      â”‚
â”‚  POST /checkout                         â”‚
â”‚  With: form data + payment details     â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
        â”‚
        â–¼
â•”â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•—
â•‘  BACKEND PROCESSING                     â•‘
â• â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•£
â•‘ 1. Verify Razorpay Signature          â•‘
â•‘    (Security check)                    â•‘
â•‘                                        â•‘
â•‘ 2. Create/Login User (if guest)       â•‘
â•‘    â€¢ Check if email exists            â•‘
â•‘    â€¢ Create new user OR               â•‘
â•‘    â€¢ Login existing user              â•‘
â•‘                                        â•‘
â•‘ 3. Update User Profile                â•‘
â•‘    â€¢ Save phone, address if new       â•‘
â•‘    â€¢ Update if changed                â•‘
â•‘                                        â•‘
â•‘ 4. Create Order Record                â•‘
â•‘    â€¢ Generate order number            â•‘
â•‘    â€¢ Save shipping details            â•‘
â•‘    â€¢ Store payment ID                 â•‘
â•‘                                        â•‘
â•‘ 5. Create Order Items                 â•‘
â•‘    â€¢ Link products to order           â•‘
â•‘    â€¢ Save quantities & prices         â•‘
â•‘                                        â•‘
â•‘ 6. Clear Cart                         â•‘
â•‘    â€¢ Delete from database             â•‘
â•‘    â€¢ Clear session cart               â•‘
â•šâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
        â”‚
        â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  REDIRECT TO SUCCESS PAGE               â”‚
â”‚  /order/success/{orderId}              â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
        â”‚
        â–¼
â•”â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•—
â•‘     ORDER CONFIRMATION PAGE            â•‘
â• â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•£
â•‘  âœ“ Order Confirmed! ğŸ‰                 â•‘
â•‘                                        â•‘
â•‘  Order Details:                        â•‘
â•‘  â€¢ Order Number                        â•‘
â•‘  â€¢ Items purchased                     â•‘
â•‘  â€¢ Total amount                        â•‘
â•‘  â€¢ Shipping address                    â•‘
â•‘                                        â•‘
â•‘  What's Next:                          â•‘
â•‘  1. Order Confirmation (email)         â•‘
â•‘  2. Order Processing                   â•‘
â•‘  3. Shipping with tracking             â•‘
â•‘                                        â•‘
â•‘  [Continue Shopping] [View Order]      â•‘
â•šâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
```

## ğŸ” Security Flow

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    SECURITY LAYERS                        â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                           â”‚
â”‚  1. FRONTEND VALIDATION                                  â”‚
â”‚     âœ“ Required fields check                             â”‚
â”‚     âœ“ Email format validation                           â”‚
â”‚     âœ“ Phone number format (10 digits)                   â”‚
â”‚     âœ“ Pincode format (6 digits)                         â”‚
â”‚     âœ“ Password strength (min 8 chars)                   â”‚
â”‚                                                           â”‚
â”‚  2. CSRF PROTECTION                                      â”‚
â”‚     âœ“ Laravel CSRF tokens on all forms                  â”‚
â”‚     âœ“ Inertia.js automatic token handling               â”‚
â”‚                                                           â”‚
â”‚  3. RAZORPAY SIGNATURE VERIFICATION                      â”‚
â”‚     âœ“ Hash payment details with secret                  â”‚
â”‚     âœ“ Compare with Razorpay signature                   â”‚
â”‚     âœ“ Reject if mismatch                                â”‚
â”‚                                                           â”‚
â”‚  4. BACKEND VALIDATION                                   â”‚
â”‚     âœ“ Re-validate all fields                            â”‚
â”‚     âœ“ Check cart not empty                              â”‚
â”‚     âœ“ Verify product availability                       â”‚
â”‚                                                           â”‚
â”‚  5. PASSWORD SECURITY                                    â”‚
â”‚     âœ“ Bcrypt hashing (Laravel default)                  â”‚
â”‚     âœ“ Salt automatically added                          â”‚
â”‚     âœ“ Never stored in plain text                        â”‚
â”‚                                                           â”‚
â”‚  6. DATABASE TRANSACTIONS                                â”‚
â”‚     âœ“ All-or-nothing order creation                     â”‚
â”‚     âœ“ Rollback on error                                 â”‚
â”‚     âœ“ Data consistency guaranteed                       â”‚
â”‚                                                           â”‚
â”‚  7. AUTHORIZATION                                        â”‚
â”‚     âœ“ Orders linked to users                            â”‚
â”‚     âœ“ Access control on order view                      â”‚
â”‚     âœ“ Admin/user permission checks                      â”‚
â”‚                                                           â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

## ğŸ“Š Data Flow

```
GUEST USER FIRST ORDER:
â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”
Enter Details â†’ Create Account â†’ Save Address â†’ Place Order
                    â†“                â†“               â†“
                User Record     Update Profile   Order Record
                (password)      (address)        (linked to user)

RETURNING USER:
â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”
Login â†’ Pre-fill Data â†’ Edit (optional) â†’ Place Order
          â†“                    â†“               â†“
    From User Table    Update if Changed  Order Record
```

## ğŸ¯ State Management

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                   REACT STATE                            â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                          â”‚
â”‚  currentStep: 1 | 2                                     â”‚
â”‚  â†³ Controls which form is displayed                    â”‚
â”‚                                                          â”‚
â”‚  form: {                                                â”‚
â”‚    name, email, phone, password,                        â”‚
â”‚    address, city, state, pincode, country              â”‚
â”‚  }                                                       â”‚
â”‚  â†³ Stores all user input                               â”‚
â”‚                                                          â”‚
â”‚  errors: {}                                             â”‚
â”‚  â†³ Validation error messages                           â”‚
â”‚                                                          â”‚
â”‚  loading: boolean                                       â”‚
â”‚  â†³ Payment processing state                            â”‚
â”‚                                                          â”‚
â”‚  cartItems: []                                          â”‚
â”‚  â†³ Products being purchased                            â”‚
â”‚                                                          â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

## ğŸ’¾ Database Schema Relationships

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”         â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”         â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚   USERS     â”‚â”€â”€â”€â”€1:Nâ”€â”€â”‚   ORDERS    â”‚â”€â”€â”€â”€1:Nâ”€â”€â”‚ ORDER_ITEMS â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤         â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤         â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ id          â”‚         â”‚ id          â”‚         â”‚ id          â”‚
â”‚ name        â”‚         â”‚ user_id  FK â”‚         â”‚ order_id FK â”‚
â”‚ email       â”‚         â”‚ order_numberâ”‚         â”‚ product_id  â”‚
â”‚ password    â”‚         â”‚ total_amountâ”‚         â”‚ quantity    â”‚
â”‚ phone       â”‚â—„â”€â”€â”€â”€â”   â”‚ status      â”‚         â”‚ price       â”‚
â”‚ address     â”‚     â”‚   â”‚ ship_addressâ”‚         â”‚ size        â”‚
â”‚ city        â”‚     â”‚   â”‚ ship_city   â”‚         â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
â”‚ state       â”‚     â”‚   â”‚ ship_state  â”‚
â”‚ pincode     â”‚     â”‚   â”‚ ship_pincodeâ”‚
â”‚ country     â”‚     â”‚   â”‚ phone       â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜     â”‚   â”‚ notes       â”‚
                    â”‚   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                    â”‚
                    â””â”€â”€ User address info
                        copied to order
                        for record keeping
```

## ğŸš€ Performance Optimizations

```
âœ“ Lazy loading of Razorpay script
âœ“ Single API call for cart items
âœ“ Debounced validation
âœ“ Optimistic UI updates
âœ“ Database indexing (user_id, order_id)
âœ“ Eager loading (with('product'))
âœ“ Minimal re-renders (React memo where needed)
```

---

**Built with â¤ï¸ for Avhira**
*Modern, Secure, User-Friendly Checkout Experience*
