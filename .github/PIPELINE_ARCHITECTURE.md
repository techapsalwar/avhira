# ๐ CI/CD Pipeline Architecture - Avhira

## Deployment Flow Diagram

```
โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
โ                     DEVELOPER WORKFLOW                           โ
โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
                              โ
                              โ git push origin main
                              โผ
โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
โ                        GITHUB                                    โ
โ  โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ โ
โ  โ  Repository: techapsalwar/avhira                       โ โ
โ  โ  - Receives code push                                      โ โ
โ  โ  - Triggers GitHub Actions                                 โ โ
โ  โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ โ
โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
                              โ
                              โ Workflow triggered
                              โผ
โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
โ               GITHUB ACTIONS (Build Server)                      โ
โ                                                                  โ
โ  Step 1: ๐ Checkout code from repository                       โ
โ  Step 2: ๐ Setup PHP 8.2 environment                           โ
โ  Step 3: ๐ฆ composer install --no-dev --optimize-autoloader    โ
โ  Step 4: ๐ข Setup Node.js 18                                    โ
โ  Step 5: ๐ฆ npm ci (install dependencies)                       โ
โ  Step 6: ๐๏ธ  npm run build (Vite compilation)                   โ
โ  Step 7: ๐ฆ Create deployment.tar.gz archive                    โ
โ  Step 8: ๐ค Upload via SCP to Hostinger                         โ
โ  Step 9: ๐ง Execute deployment script via SSH                   โ
โ                                                                  โ
โ  Time: ~2-3 minutes                                             โ
โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
                              โ
                              โ SSH connection
                              โ Port: 65002
                              โผ
โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
โ            HOSTINGER SERVER (89.117.188.174)                     โ
โ                                                                  โ
โ  User: u885878505                                               โ
โ  Path: /home/u885878505/public_html/avhira/                    โ
โ                                                                  โ
โ  โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ โ
โ  โ  DEPLOYMENT SCRIPT EXECUTION                               โ โ
โ  โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโค โ
โ  โ  1. ๐ฆ Backup current deployment                           โ โ
โ  โ     tar -czf backup-TIMESTAMP.tar.gz current/             โ โ
โ  โ                                                            โ โ
โ  โ  2. ๐ Create new release directory                        โ โ
โ  โ     releases/20250106-143022/                             โ โ
โ  โ                                                            โ โ
โ  โ  3. ๐ฆ Extract deployment package                          โ โ
โ  โ     tar -xzf /tmp/deployment.tar.gz                       โ โ
โ  โ                                                            โ โ
โ  โ  4. ๐ Setup shared directories                            โ โ
โ  โ     - shared/storage/                                     โ โ
โ  โ     - shared/bootstrap/cache/                             โ โ
โ  โ     - shared/.env                                         โ โ
โ  โ                                                            โ โ
โ  โ  5. ๐ Create symlinks                                     โ โ
โ  โ     ln -s shared/storage                                  โ โ
โ  โ     ln -s shared/.env                                     โ โ
โ  โ                                                            โ โ
โ  โ  6. ๐ Set permissions                                     โ โ
โ  โ     chmod -R 755 storage bootstrap/cache                  โ โ
โ  โ                                                            โ โ
โ  โ  7. ๐ Update current symlink (ZERO DOWNTIME)             โ โ
โ  โ     current -> releases/20250106-143022                   โ โ
โ  โ                                                            โ โ
โ  โ  8. โ๏ธ  Laravel optimizations                              โ โ
โ  โ     php artisan config:cache                              โ โ
โ  โ     php artisan route:cache                               โ โ
โ  โ     php artisan view:cache                                โ โ
โ  โ                                                            โ โ
โ  โ  9. ๐๏ธ  Database migrations                                โ โ
โ  โ     php artisan migrate --force                           โ โ
โ  โ                                                            โ โ
โ  โ  10. ๐งน Cleanup old releases                               โ โ
โ  โ      (keep last 3 releases)                               โ โ
โ  โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ โ
โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
                              โ
                              โ Deployment complete
                              โผ
โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
โ                    LIVE WEBSITE                                  โ
โ                                                                  โ
โ  https://yourdomain.com                                         โ
โ  โโโ Hero carousel with animations                              โ
โ  โโโ Product catalog                                            โ
โ  โโโ Shopping cart                                              โ
โ  โโโ Checkout with Razorpay                                     โ
โ  โโโ User authentication                                        โ
โ                                                                  โ
โ  Status: โ Live and running                                     โ
โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
```

---

## Directory Structure on Hostinger

```
/home/u885878505/public_html/avhira/
โ
โโโ current โ releases/20250106-143022  [Symlink - Live version]
โ
โโโ releases/
โ   โโโ 20250106-143022/  โ Current (Latest deployment)
โ   โโโ 20250106-135500/  โ Previous
โ   โโโ 20250106-120000/  โ Older
โ
โโโ shared/  [Persistent across deployments]
โ   โโโ .env  [Production environment config]
โ   โโโ storage/
โ   โ   โโโ app/
โ   โ   โ   โโโ public/  [Uploaded images/files]
โ   โ   โ   โโโ private/
โ   โ   โโโ framework/
โ   โ   โ   โโโ cache/
โ   โ   โ   โโโ sessions/
โ   โ   โ   โโโ views/
โ   โ   โโโ logs/
โ   โ       โโโ laravel.log
โ   โโโ bootstrap/
โ       โโโ cache/
โ
โโโ backups/
    โโโ backup-20250106-143022.tar.gz
    โโโ backup-20250106-135500.tar.gz
    โโโ backup-20250106-120000.tar.gz
```

---

## Component Interaction

```
โโโโโโโโโโโโโโโโ
โ   Browser    โ
โ              โ
โ  End Users   โ
โโโโโโโโฌโโโโโโโโ
       โ HTTPS
       โผ
โโโโโโโโโโโโโโโโโโโโโโโโโโโโ
โ   Hostinger Web Server   โ
โ   (Apache/LiteSpeed)     โ
โโโโโโโโฌโโโโโโโโโโโโโโโโโโโโ
       โ Document Root
       โผ
โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
โ  current/public/index.php  โ โ Symlink to latest release
โโโโโโโโโโฌโโโโโโโโโโโโโโโโโโโโ
         โ
         โผ
โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
โ   Laravel Application       โ
โ   (current/ directory)      โ
โ                             โ
โ   โโโ app/                  โ
โ   โโโ resources/            โ
โ   โโโ routes/               โ
โ   โโโ public/               โ
โโโโโโโโโโฌโโโโโโโโโโโโโโโโโโโโโ
         โ
         โโโโโโโโโโโโโโโโโโโโโโโ
         โ                     โ
         โผ                     โผ
โโโโโโโโโโโโโโโโโ    โโโโโโโโโโโโโโโโโโโโ
โ  MySQL DB     โ    โ  Shared Storage  โ
โ               โ    โ                  โ
โ  Database:    โ    โ  - .env          โ
โ  u885878505_  โ    โ  - uploads       โ
โ  avhira       โ    โ  - sessions      โ
โโโโโโโโโโโโโโโโโ    โ  - logs          โ
                     โ  - cache         โ
                     โโโโโโโโโโโโโโโโโโโโ
```

---

## Deployment Timeline

```
T+0s    โ Developer pushes code
        โ
T+5s    โ GitHub receives push
        โ GitHub Actions triggered
        โ
T+10s   โ Checkout code
        โ
T+30s   โ Setup PHP 8.2
        โ
T+45s   โ Install Composer dependencies
        โ
T+60s   โ Setup Node.js
        โ
T+75s   โ Install NPM dependencies
        โ
T+90s   โ Build assets with Vite
        โ
T+120s  โ Create deployment archive
        โ
T+135s  โ Upload to Hostinger (SCP)
        โ
T+150s  โ Execute deployment script
        โ โโโ Backup current
        โ โโโ Extract new release
        โ โโโ Create symlinks
        โ โโโ Set permissions
        โ โโโ Update current symlink โ ZERO DOWNTIME
        โ โโโ Cache config/routes/views
        โ โโโ Run migrations
        โ โโโ Cleanup old releases
        โ
T+180s  โ โ Deployment complete!
        โ Website updated and live
```

---

## Zero-Downtime Deployment

```
Before Deployment:
current โ releases/20250106-120000  (Old version serving users)

During Deployment:
[New release being prepared in: releases/20250106-143022]
[Users still being served from: releases/20250106-120000]
โ
[Symlink update happens instantly]
โ
current โ releases/20250106-143022  (Atomic operation)

After Deployment:
current โ releases/20250106-143022  (New version serving users)
releases/20250106-120000  (Still available for rollback)
```

**Downtime:** 0 seconds! โ

---

## Rollback Process

```
Issue Detected
     โ
SSH to Server
     โ
Change Symlink
     โ
current โ releases/PREVIOUS_VERSION
     โ
โ Instant Rollback!
     โ
Time: ~5 seconds
```

---

## Security Flow

```
โโโโโโโโโโโโโโโโโโโโโโโ
โ  GitHub Secrets     โ
โ  (Encrypted)        โ
โ                     โ
โ  - SSH_HOST         โ
โ  - SSH_USERNAME     โ
โ  - SSH_PASSWORD     โ
โ  - SSH_PORT         โ
โ  - PROJECT_PATH     โ
โโโโโโโโโโโฌโโโโโโโโโโโโ
          โ Only accessible to
          โ GitHub Actions
          โผ
โโโโโโโโโโโโโโโโโโโโโโโ
โ  GitHub Actions     โ
โ  Runner (Isolated)  โ
โโโโโโโโโโโฌโโโโโโโโโโโโ
          โ SSH Connection
          โ (Encrypted)
          โผ
โโโโโโโโโโโโโโโโโโโโโโโ
โ  Hostinger Server   โ
โ  (SSH Port 65002)   โ
โโโโโโโโโโโโโโโโโโโโโโโ
```

---

## Data Persistence

```
Deployment Update: โ Replaced
โ
โโโ app/
โโโ resources/
โโโ routes/
โโโ vendor/
โโโ public/

Persistent Data: โ Preserved
โ
โโโ .env (shared/)
โโโ storage/app/public/ (uploads)
โโโ storage/logs/
โโโ storage/framework/sessions/
โโโ bootstrap/cache/
```

---

## Monitoring & Logs

```
โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
โ     Deployment Monitoring          โ
โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโค
โ                                    โ
โ  GitHub Actions Logs               โ
โ  โโโ Real-time build output        โ
โ  โโโ Error detection               โ
โ  โโโ Success/Failure notification  โ
โ                                    โ
โ  Laravel Application Logs          โ
โ  โโโ storage/logs/laravel.log      โ
โ                                    โ
โ  Server Error Logs                 โ
โ  โโโ hPanel โ Files โ error_log    โ
โ                                    โ
โ  Database Logs                     โ
โ  โโโ MySQL slow query log          โ
โ                                    โ
โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
```

---

## Automatic Backup Strategy

```
Every Deployment:
โโโ Create backup of current/ directory
โโโ Store as: backup-TIMESTAMP.tar.gz
โโโ Keep last 5 backups
โโโ Auto-delete older backups

Backup Locations:
/home/u885878505/public_html/avhira/
โโโ backup-20250106-143022.tar.gz  (Latest)
โโโ backup-20250106-135500.tar.gz
โโโ backup-20250106-120000.tar.gz
โโโ backup-20250105-180000.tar.gz
โโโ backup-20250105-150000.tar.gz  (Oldest kept)
```

---

## Performance Optimization

```
Build Stage (GitHub Actions):
โโโ Composer: --optimize-autoloader --no-dev
โโโ NPM: Production build
โโโ Vite: Asset minification & bundling

Deployment Stage (Hostinger):
โโโ Config caching (config:cache)
โโโ Route caching (route:cache)
โโโ View caching (view:cache)
โโโ Optimized autoloader

Result:
โโโ Faster page loads โก
```

---

## CI/CD Best Practices Implemented

โ **Automated Testing** - Can add phpunit/pest tests  
โ **Atomic Deployments** - Symlink switching  
โ **Zero Downtime** - Users never see deployment  
โ **Automatic Rollback** - Previous versions kept  
โ **Environment Separation** - Shared .env file  
โ **Asset Compilation** - Automated CSS/JS build  
โ **Database Migrations** - Auto-applied  
โ **Cache Optimization** - Pre-warmed caches  
โ **Backup Strategy** - Automated backups  
โ **Release Management** - Version control  

---

**Pipeline Status: โ Production Ready**  
**Deployment Method: Blue-Green Deployment via Symlinks**  
**Average Deployment Time: 2-3 minutes**  
**Downtime: 0 seconds**
